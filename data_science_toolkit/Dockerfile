FROM sinclair1992/jupyterhub_gpu
RUN apt-get install apt-utils apt-transport-https ca-certificates dirmngr -y --no-install-recommends && apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv E0C56BD4 && echo "deb https://repo.clickhouse.com/deb/stable/ main/" | tee /etc/apt/sources.list.d/clickhouse.list && apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y clickhouse-server clickhouse-client && sed -i 's/<!-- <listen_host>0.0.0.0<\/listen_host> -->/<listen_host>0.0.0.0<\/listen_host>/g' /etc/clickhouse-server/config.xml && sed -i 's/var\/log/home\/data\/clickhouse\/log/g' /etc/clickhouse-server/config.xml
CMD mkdir -p /home/data/clickhouse/log/clickhouse-server && mkdir -p /home/data/clickhouse/tmp && mkdir -p /home/data/clickhouse/user_files && mkdir -p /home/data/clickhouse/access && mkdir -p /home/data/clickhouse/format_schemas && chown -R clickhouse:clickhouse /home/data/clickhouse && clickhouse start && tail -f /dev/null
